
(function($){$.fn.editableOptions=function(callback){return $(this).each(function(){var select=$(this);if(!select.data("_editableOptions_dblclick")){select.keyup(function(e){if(e.keyCode===113){select.find('option:selected:first').dblclick();}});select.data("_editableOptions_dblclick",true);}
select.find('option').each(function(){var option=$(this);if(option.data("_editableOptions_isEditable")){return;}
option.data("_editableOptions_isEditable",true);option.dblclick(function(){var text=$('<input type="text" />');text.css({"position":"absolute","padding":0,"margin":0,"border":"none","outline":"none","font-family":select.css("font-family"),"font-size":select.css("font-size"),});if(option.width()===0){var select_size=select.attr("size");var option_height;if(select_size==0){var test=$('<select size="4">').css({display:"none",fontSize:select.css("font-size")}).appendTo('body');option_height=test.innerHeight()/4;test.remove();}else{if(select_size<4){select_size=4;}
option_height=select.innerHeight()/select_size;}
text.css({"top":select.position().top+
parseInt(select.css("margin-top"))+
parseInt(select.css("border-top-width"))+
parseInt(select.css("padding-top"))+
select.attr("selectedIndex")*option_height-
select.scrollTop(),"left":select.position().left+
parseInt(select.css("margin-left"))+
parseInt(select.css("border-left-width"))+
parseInt(select.css("padding-left")),"width":select.width()-11,"padding":1,});}else{var position=option.position();var left_offset=position.left;var top_offset=position.top;if(select.css("position")==="absolute"){var select_position=select.position();left_offset+=select_position.left+parseInt(select.css("border-left-width"));top_offset+=select_position.top+parseInt(select.css("border-top-width"));}
text.css({"left":left_offset,"top":top_offset,"padding-left":option.css("padding-left"),"height":option.height(),"width":option.outerWidth(),});}
var save=function(text){option.text(text.value);$(text).remove();if(callback!==undefined){callback(option.context);}};text.val(option.text()).keyup(function(e){if(e.keyCode===13){text.blur();}else if(e.keyCode===27){text.remove();select.focus();}else if(e.keyCode===38||e.keyCode===40){if(e.keyCode===38){sibling=option.prev();}else if(e.keyCode===40){sibling=option.next();}
if(sibling.length>0){option.attr("selected",false);save(this);if(option_height!==undefined&&select.attr("multiple")){select.attr("multiple",false);sibling.attr("selected",true);select.attr("multiple",true);}else{sibling.attr("selected",true);}
sibling.dblclick();}}}).blur(function(){save(this);select.focus();}).insertAfter(select).focus().select();});});});};})(jQuery);